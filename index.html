<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Uda-Mandi</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container" style="max-width: 400px; margin-top: 80px;">
    <h2>Login Portal</h2>
    
    <div id="login-form">
        <label>Email / Username</label>
        <input type="text" id="email" placeholder="Enter Email">
        
        <label>Password</label>
        <input type="password" id="password" placeholder="Enter Password">
        
        <button class="btn-login" onclick="attemptLogin()">Login</button>
    </div>

    <div id="waiting-screen" class="hidden" style="text-align: center;">
        <h3>Verification Pending...</h3>
        <p>Please wait. The Admin needs to approve your login.</p>
        <div class="loader"></div>
        <br><br>
        <p style="font-size: 18px; color: #007bff;">Your OTP: <strong id="user-otp-display"></strong></p>
        <p style="font-size: 12px; color: gray;">(Share this OTP with Admin if asked)</p>
        <button class="btn-secondary" onclick="cancelLogin()">Cancel</button>
    </div>

</div>

<script>
    const ADMIN_ID = "shivshreek@gmail.com";
    const ADMIN_PASS = "Shiv@2004.";

    let checkInterval;

    function attemptLogin() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;

        // 1. Check if Admin
        if (email === ADMIN_ID && pass === ADMIN_PASS) {
            localStorage.setItem('role', 'admin');
            window.location.href = 'admin.html';
            return;
        }

        // 2. If User (Password "user" for demo, or anything else)
        if (email) {
            startUserApprovalProcess(email);
        } else {
            alert("Please enter a username/email");
        }
    }

    function startUserApprovalProcess(username) {
        // Generate OTP
        const otp = Math.floor(1000 + Math.random() * 9000);
        
        // Show Waiting Screen
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('waiting-screen').classList.remove('hidden');
        document.getElementById('user-otp-display').innerText = otp;

        // Save Request to LocalStorage (Admin will read this)
        const request = {
            user: username,
            otp: otp,
            status: 'pending', // pending, approved
            timestamp: new Date().getTime()
        };
        localStorage.setItem('login_request', JSON.stringify(request));

        // Start checking every 1 second if Admin approved
        checkInterval = setInterval(() => {
            const currentReq = JSON.parse(localStorage.getItem('login_request'));
            
            if (currentReq && currentReq.status === 'approved') {
                clearInterval(checkInterval);
                localStorage.setItem('role', 'user');
                localStorage.setItem('currentUser', username);
                alert("Login Approved by Admin!");
                window.location.href = 'user.html';
            }
            
            // If request is deleted (Admin rejected)
            if (!currentReq) {
                clearInterval(checkInterval);
                alert("Login Rejected.");
                cancelLogin();
            }

        }, 1000);
    }

    function cancelLogin() {
        clearInterval(checkInterval);
        localStorage.removeItem('login_request');
        document.getElementById('waiting-screen').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
    }
</script>

</body>
</html>
