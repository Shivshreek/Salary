<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Slip Management System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .hidden {
            display: none !important;
        }
        
        .salary-table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .salary-table th, .salary-table td {
            border: 1px solid #e5e7eb;
            padding: 8px 12px;
            text-align: left;
        }
        
        .salary-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .salary-table tr:hover {
            background-color: #f9fafb;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Dark mode styles */
        .dark .salary-table th,
        .dark .salary-table td {
            border-color: #374151;
        }
        
        .dark .salary-table th {
            background-color: #1f2937;
            color: #f9fafb;
        }
        
        .dark .salary-table tr:hover {
            background-color: #1f2937;
        }
        
        /* Skeleton loading animation */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #2d3748 25%, #4a5568 50%, #2d3748 75%);
            background-size: 1000px 100%;
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .bg-white, .shadow-lg, .rounded-xl {
                background: white !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                border: 1px solid #000 !important;
            }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .toast.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Glass effect */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <script>
        // Initialize Tailwind CSS with custom config
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                    }
                }
            }
        };
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="spinner mx-auto"></div>
            <p class="mt-4 text-gray-600 dark:text-gray-400">Loading...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center gradient-bg p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="dollar-sign" class="w-10 h-10 text-blue-600 dark:text-blue-400"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Salary Portal</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Secure salary management system</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Username</label>
                    <input id="username" type="text" 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                           placeholder="Enter username">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                    <input id="password" type="password" 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                           placeholder="Enter password">
                </div>
                
                <div id="login-error" class="bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 p-3 rounded-lg hidden"></div>
                
                <button onclick="handleLogin()" 
                        class="w-full bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 text-white py-3 rounded-lg font-semibold transition duration-200 flex items-center justify-center space-x-2">
                    <i data-lucide="log-in" class="w-5 h-5"></i>
                    <span>Sign In</span>
                </button>
            </div>
            
            <div class="mt-6 text-center text-sm text-gray-600 dark:text-gray-400">
                <p class="font-semibold">Default Admin:</p>
                <p>Username: <span class="font-mono">admin@company.com</span></p>
                <p>Password: <span class="font-mono">Admin@123</span></p>
            </div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app-container" class="hidden">
        <!-- Navigation Sidebar -->
        <div id="sidebar" class="fixed left-0 top-0 h-screen w-64 bg-white dark:bg-gray-800 shadow-lg transform transition-transform duration-300 -translate-x-full lg:translate-x-0">
            <div class="p-6">
                <div class="flex items-center space-x-3 mb-8">
                    <i data-lucide="dollar-sign" class="w-8 h-8 text-blue-600 dark:text-blue-400"></i>
                    <h1 class="text-xl font-bold text-gray-800 dark:text-white">Salary Portal</h1>
                </div>
                
                <nav class="space-y-2">
                    <button onclick="switchView('dashboard')" class="sidebar-btn active w-full text-left">
                        <i data-lucide="home" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </button>
                    
                    <button onclick="switchView('salary-slip')" class="sidebar-btn w-full text-left">
                        <i data-lucide="file-text" class="w-5 h-5"></i>
                        <span>Salary Slip</span>
                    </button>
                    
                    <button onclick="switchView('history')" class="sidebar-btn w-full text-left">
                        <i data-lucide="history" class="w-5 h-5"></i>
                        <span>History</span>
                    </button>
                    
                    <div id="admin-nav" class="hidden">
                        <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-6 mb-2">Admin Tools</div>
                        
                        <button onclick="switchView('user-management')" class="sidebar-btn w-full text-left">
                            <i data-lucide="users" class="w-5 h-5"></i>
                            <span>User Management</span>
                        </button>
                        
                        <button onclick="switchView('analytics')" class="sidebar-btn w-full text-left">
                            <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                            <span>Analytics</span>
                        </button>
                        
                        <button onclick="switchView('settings')" class="sidebar-btn w-full text-left">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Settings</span>
                        </button>
                        
                        <button onclick="switchView('bulk-export')" class="sidebar-btn w-full text-left">
                            <i data-lucide="download" class="w-5 h-5"></i>
                            <span>Bulk Export</span>
                        </button>
                    </div>
                </nav>
                
                <div class="absolute bottom-6 left-6 right-6">
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Logged in as:</p>
                        <p class="font-semibold text-gray-800 dark:text-white truncate" id="current-user-email">user@example.com</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="lg:ml-64 min-h-screen">
            <!-- Top Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700">
                <div class="px-4 py-4 flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleSidebar()" class="lg:hidden text-gray-600 dark:text-gray-400">
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>
                        <h2 id="page-title" class="text-xl font-semibold text-gray-800 dark:text-white">Dashboard</h2>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button onclick="toggleDarkMode()" 
                                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                            <i data-lucide="sun" id="theme-icon" class="w-5 h-5"></i>
                        </button>
                        
                        <div class="relative">
                            <button onclick="toggleNotifications()" 
                                    class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                                <i data-lucide="bell" class="w-5 h-5"></i>
                                <span id="notification-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                            </button>
                        </div>
                        
                        <button onclick="handleLogout()" 
                                class="flex items-center space-x-2 bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 px-4 py-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900 transition">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main id="main-content" class="p-4 md:p-6">
                <!-- Views will be loaded here dynamically -->
                
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Total Earnings</p>
                                    <p class="text-2xl font-bold text-green-600 dark:text-green-400">₹<span id="total-earnings-dash">0</span></p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg">
                                    <i data-lucide="trending-up" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Saved Slips</p>
                                    <p class="text-2xl font-bold text-blue-600 dark:text-blue-400"><span id="saved-slips-count">0</span></p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                                    <i data-lucide="file-text" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">This Month</p>
                                    <p class="text-2xl font-bold text-purple-600 dark:text-purple-400">₹<span id="this-month-salary">0</span></p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-lg">
                                    <i data-lucide="calendar" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Total Users</p>
                                    <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400"><span id="total-users-dash">0</span></p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-lg">
                                    <i data-lucide="users" class="w-6 h-6 text-yellow-600 dark:text-yellow-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Quick Actions</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="switchView('salary-slip')" 
                                    class="p-4 bg-blue-50 dark:bg-blue-900/50 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900 transition flex items-center space-x-3">
                                <i data-lucide="plus-circle" class="w-6 h-6 text-blue-600 dark:text-blue-400"></i>
                                <span class="font-medium text-gray-800 dark:text-white">Create Salary Slip</span>
                            </button>
                            
                            <button onclick="generateCurrentMonthSlip()" 
                                    class="p-4 bg-green-50 dark:bg-green-900/50 rounded-lg hover:bg-green-100 dark:hover:bg-green-900 transition flex items-center space-x-3">
                                <i data-lucide="zap" class="w-6 h-6 text-green-600 dark:text-green-400"></i>
                                <span class="font-medium text-gray-800 dark:text-white">Auto-Generate This Month</span>
                            </button>
                            
                            <button onclick="switchView('history')" 
                                    class="p-4 bg-purple-50 dark:bg-purple-900/50 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900 transition flex items-center space-x-3">
                                <i data-lucide="history" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                                <span class="font-medium text-gray-800 dark:text-white">View History</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Recent Activity</h3>
                        <div id="recent-activity" class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                        <i data-lucide="file-text" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Salary slip generated</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">January 2024 - ₹59,900</p>
                                    </div>
                                </div>
                                <span class="text-sm text-gray-500">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Salary Slip View -->
                <div id="salary-slip-view" class="view-content hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h1 class="text-2xl font-bold">SALARY SLIP</h1>
                                    <p class="text-blue-100 mt-1" id="pay-period">January 2024</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="saveSalaryToHistory()" 
                                            class="flex items-center space-x-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition no-print">
                                        <i data-lucide="save" class="w-4 h-4"></i>
                                        <span>Save Slip</span>
                                    </button>
                                    <button onclick="printSalarySlip()"
                                            class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition no-print">
                                        <i data-lucide="printer" class="w-4 h-4"></i>
                                        <span>Print</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Employee Details -->
                        <div class="p-6 border-b dark:border-gray-700">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Employee Name</label>
                                    <input id="employee-name-input" type="text" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Designation</label>
                                    <input id="designation-input" type="text" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Department</label>
                                    <input id="department-input" type="text" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Bank Account</label>
                                    <input id="bank-account-input" type="text" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Paid Days</label>
                                    <input id="paid-days-input" type="number" value="31"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Loss of Pay Days</label>
                                    <input id="lop-days-input" type="number" value="0"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">PAN Number</label>
                                    <input id="pan-number-input" type="text" 
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                            </div>
                            
                            <div class="mt-4 flex justify-end">
                                <button onclick="calculateSalary()" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                                    Calculate Salary
                                </button>
                            </div>
                        </div>

                        <!-- Earnings Section -->
                        <div class="p-6 border-b dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Earnings</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Basic Salary</label>
                                    <input id="basic-input" type="number" value="30000"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">HRA</label>
                                    <input id="hra-input" type="number" value="12000"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Special Allowance</label>
                                    <input id="special-input" type="number" value="15350"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Bonus</label>
                                    <input id="bonus-input" type="number" value="5000"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>
                            </div>
                        </div>

                        <!-- Salary Details Table -->
                        <div class="overflow-x-auto">
                            <table class="salary-table">
                                <thead>
                                    <tr>
                                        <th colspan="2" class="text-center bg-blue-50 dark:bg-gray-700">EARNINGS</th>
                                        <th colspan="2" class="text-center bg-blue-50 dark:bg-gray-700">DEDUCTIONS</th>
                                    </tr>
                                    <tr>
                                        <th class="dark:text-gray-200">Particulars</th>
                                        <th class="dark:text-gray-200">Amount (₹)</th>
                                        <th class="dark:text-gray-200">Particulars</th>
                                        <th class="dark:text-gray-200">Amount (₹)</th>
                                    </tr>
                                </thead>
                                <tbody class="dark:text-gray-300">
                                    <tr>
                                        <td>Basic</td>
                                        <td id="basic-amount">30,000</td>
                                        <td>Provident Fund</td>
                                        <td id="pf-amount">3,600</td>
                                    </tr>
                                    <tr>
                                        <td>House Rent Allowance</td>
                                        <td id="hra-amount">12,000</td>
                                        <td>ESI</td>
                                        <td id="esi-amount">0</td>
                                    </tr>
                                    <tr>
                                        <td>Conveyance Allowance</td>
                                        <td id="conveyance-amount">1,600</td>
                                        <td>Professional Tax</td>
                                        <td id="pt-amount">200</td>
                                    </tr>
                                    <tr>
                                        <td>Medical Allowance</td>
                                        <td id="medical-amount">1,250</td>
                                        <td>TDS</td>
                                        <td id="tds-amount">1,500</td>
                                    </tr>
                                    <tr>
                                        <td>Special Allowance</td>
                                        <td id="special-amount">15,350</td>
                                        <td>Loan Recovery</td>
                                        <td id="loan-amount">1,000</td>
                                    </tr>
                                    <tr>
                                        <td>Overtime</td>
                                        <td id="overtime-amount">2,000</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="font-semibold bg-gray-50 dark:bg-gray-700">
                                        <td class="dark:text-white">Total Earnings</td>
                                        <td class="dark:text-white" id="total-earnings">66,200</td>
                                        <td class="dark:text-white">Total Deductions</td>
                                        <td class="dark:text-white" id="total-deductions">6,300</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Net Pay Section -->
                        <div class="p-6 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-gray-700 dark:to-gray-800">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">NET PAYABLE</p>
                                    <p class="text-3xl font-bold text-green-700 dark:text-green-400" id="net-pay">₹59,900</p>
                                    <p class="text-gray-600 dark:text-gray-400 italic mt-1" id="net-pay-words">
                                        Fifty Nine Thousand Nine Hundred Rupees Only
                                    </p>
                                </div>
                                <div class="text-right space-x-2 no-print">
                                    <button onclick="shareOnWhatsApp()" 
                                            class="bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center space-x-2">
                                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                                        <span>Share on WhatsApp</span>
                                    </button>
                                    <button onclick="downloadAsPDF()" 
                                            class="bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center space-x-2">
                                        <i data-lucide="download" class="w-5 h-5"></i>
                                        <span>Download PDF</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reverse Calculator Section -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Reverse Calculator (CTC to In-Hand)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Desired In-Hand Salary</label>
                                <input id="desired-salary-input" type="number" placeholder="Enter amount"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Basic % of CTC</label>
                                <input id="basic-percentage-input" type="number" value="50"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            </div>
                            <div class="flex items-end">
                                <button onclick="calculateReverseSalary()" 
                                        class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                                    Calculate CTC
                                </button>
                            </div>
                        </div>
                        <div id="reverse-result" class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hidden">
                            <h4 class="font-semibold text-gray-800 dark:text-white mb-2">Required CTC Structure:</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">CTC Required</p>
                                    <p class="font-bold text-green-600 dark:text-green-400">₹<span id="required-ctc">0</span></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Basic Salary</p>
                                    <p class="font-bold">₹<span id="ctc-basic">0</span></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">HRA</p>
                                    <p class="font-bold">₹<span id="ctc-hra">0</span></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Other Allowances</p>
                                    <p class="font-bold">₹<span id="ctc-allowances">0</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Salary History View -->
                <div id="history-view" class="view-content hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Salary History</h2>
                                <p class="text-gray-600 dark:text-gray-400">Your saved salary slips</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="relative">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    <input type="text" placeholder="Search history..." 
                                           class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white"
                                           oninput="searchHistory(this.value)">
                                </div>
                                <button onclick="clearHistory()" 
                                        class="bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 px-4 py-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900 transition">
                                    Clear All
                                </button>
                            </div>
                        </div>
                        
                        <!-- History Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                <div class="text-sm text-gray-600 dark:text-gray-400">Total Saved Slips</div>
                                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="total-saved-slips">0</div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                <div class="text-sm text-gray-600 dark:text-gray-400">Total Earnings</div>
                                <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="total-history-earnings">₹0</div>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                                <div class="text-sm text-gray-600 dark:text-gray-400">Average Salary</div>
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="average-salary">₹0</div>
                            </div>
                        </div>
                        
                        <!-- History List -->
                        <div class="space-y-4 max-h-[600px] overflow-y-auto custom-scrollbar p-1" id="salary-history-list">
                            <!-- History items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Admin Views (Hidden for non-admins) -->
                <div id="admin-views" class="hidden">
                    <!-- User Management View -->
                    <div id="user-management-view" class="view-content hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">User Management</h2>
                                    <p class="text-gray-600 dark:text-gray-400">Manage system users and permissions</p>
                                </div>
                                <button onclick="showAddUserModal()"
                                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center space-x-2">
                                    <i data-lucide="user-plus" class="w-4 h-4"></i>
                                    <span>Add User</span>
                                </button>
                            </div>
                            
                            <!-- Search and Filter -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search Users</label>
                                    <input type="text" placeholder="Search by name or email..." 
                                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white"
                                           oninput="searchUsers(this.value)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Filter by Role</label>
                                    <select onchange="filterUsersByRole(this.value)"
                                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                        <option value="all">All Roles</option>
                                        <option value="admin">Admin</option>
                                        <option value="employee">Employee</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Filter by Status</label>
                                    <select onchange="filterUsersByStatus(this.value)"
                                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                        <option value="all">All Status</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Users Table -->
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50 dark:bg-gray-700">
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">User</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Role</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Last Login</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics View -->
                    <div id="analytics-view" class="view-content hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6">Analytics Dashboard</h2>
                            
                            <!-- Analytics Charts -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Salary Distribution</h3>
                                    <canvas id="salaryChart" width="400" height="300"></canvas>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">User Activity</h3>
                                    <canvas id="activityChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                            
                            <!-- Monthly Statistics -->
                            <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Monthly Statistics</h3>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="total-payroll">₹0</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Total Payroll</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="avg-salary">₹0</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Avg Salary</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="active-users">0</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Active Users</div>
                                    </div>
                                    <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="slips-generated">0</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Slips Generated</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings View -->
                    <div id="settings-view" class="view-content hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6">System Settings</h2>
                            
                            <!-- Salary Component Settings -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Salary Component Settings</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">PF Percentage</label>
                                        <input id="pf-percentage" type="number" value="12" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ESI Percentage</label>
                                        <input id="esi-percentage" type="number" value="0.75" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">HRA Percentage</label>
                                        <input id="hra-percentage" type="number" value="40" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ESI Salary Limit</label>
                                        <input id="esi-limit" type="number" value="21000" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                </div>
                                <button onclick="saveSalarySettings()" 
                                        class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold">
                                    Save Settings
                                </button>
                            </div>
                            
                            <!-- Company Settings -->
                            <div class="mb-8">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Company Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Company Name</label>
                                        <input id="company-name" type="text" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Company Address</label>
                                        <input id="company-address" type="text" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- System Settings -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">System Configuration</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-white">Enable Email Notifications</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Send salary slips via email</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-white">Auto Backup Data</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Automatically backup data daily</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Export View -->
                    <div id="bulk-export-view" class="view-content hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6">Bulk Export</h2>
                            
                            <!-- Export Options -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Export Salary Data</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Month</label>
                                            <input type="month" 
                                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
                                            <select class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                                                <option value="excel">Excel (.xlsx)</option>
                                                <option value="csv">CSV (.csv)</option>
                                                <option value="pdf">PDF (.pdf)</option>
                                            </select>
                                        </div>
                                        <button onclick="exportSalaryData()" 
                                                class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
                                            <i data-lucide="download" class="w-5 h-5"></i>
                                            <span>Export Salary Data</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Export User Data</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Include Fields</label>
                                            <div class="space-y-2">
                                                <label class="flex items-center">
                                                    <input type="checkbox" class="rounded border-gray-300" checked>
                                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">User Information</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" class="rounded border-gray-300" checked>
                                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Salary Details</span>
                                                </label>
                                                <label class="flex items-center">
                                                    <input type="checkbox" class="rounded border-gray-300">
                                                    <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Login History</span>
                                                </label>
                                            </div>
                                        </div>
                                        <button onclick="exportUserData()" 
                                                class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
                                            <i data-lucide="users" class="w-5 h-5"></i>
                                            <span>Export User Data</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Export History -->
                            <div class="bg-gray-50 dark:bg-gray-700 p-6 rounded-lg">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Recent Exports</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-white">Salary Data - January 2024</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Exported 2 hours ago</p>
                                        </div>
                                        <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">
                                            <i data-lucide="download" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="add-user-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6 border-b dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Add New User</h2>
                    <button onclick="closeAddUserModal()" 
                            class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                        <input id="new-user-email" type="email" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="user@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                        <input id="new-user-password" type="password" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="••••••••">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
                        <input id="new-user-name" type="text" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="John Doe">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Role</label>
                        <select id="new-user-role" 
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition">
                            <option value="employee">Employee</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    
                    <div id="add-user-error" class="bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 p-3 rounded-lg hidden"></div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeAddUserModal()"
                                class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Cancel
                        </button>
                        <button onclick="addNewUser()"
                                class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-semibold transition flex items-center justify-center space-x-2">
                            <i data-lucide="user-plus" class="w-4 h-4"></i>
                            <span>Add User</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6 border-b dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Edit User</h2>
                    <button onclick="closeEditUserModal()" 
                            class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                        <input id="edit-user-email" type="email" disabled
                               class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
                        <input id="edit-user-name" type="text" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Role</label>
                        <select id="edit-user-role" 
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            <option value="employee">Employee</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                        <select id="edit-user-status" 
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div id="edit-user-error" class="bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 p-3 rounded-lg hidden"></div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="button" onclick="closeEditUserModal()"
                                class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-3 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Cancel
                        </button>
                        <button onclick="saveEditedUser()"
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold transition">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>

    <script>
        // Application State
        const AppState = {
            currentUser: null,
            currentRole: 'employee',
            isDarkMode: false,
            salaryHistory: [],
            users: [],
            settings: {
                pfPercentage: 12,
                esiPercentage: 0.75,
                hraPercentage: 40,
                esiLimit: 21000,
                companyName: '',
                companyAddress: ''
            },
            currentView: 'dashboard',
            editingUserId: null,
            charts: {}
        };

        // Initialize icons
        lucide.createIcons();

        // Initialize application
        function initApp() {
            loadData();
            initTheme();
            setupEventListeners();
            
            // Auto-fill demo credentials
            document.getElementById('username').value = 'admin@company.com';
            document.getElementById('password').value = 'Admin@123';
            
            // Show login screen
            switchScreen('login-screen');
        }

        // Load data from localStorage
        function loadData() {
            try {
                // Load users
                const savedUsers = localStorage.getItem('salaryAppUsers');
                if (savedUsers) {
                    AppState.users = JSON.parse(savedUsers);
                } else {
                    // Create default admin user
                    AppState.users = [{
                        id: '1',
                        email: 'admin@company.com',
                        password: 'Admin@123',
                        name: 'System Administrator',
                        role: 'admin',
                        status: 'active',
                        lastLogin: new Date().toISOString(),
                        createdAt: new Date().toISOString()
                    }];
                    saveUsers();
                }

                // Load salary history
                const savedHistory = localStorage.getItem('salaryAppHistory');
                if (savedHistory) {
                    AppState.salaryHistory = JSON.parse(savedHistory);
                }

                // Load settings
                const savedSettings = localStorage.getItem('salaryAppSettings');
                if (savedSettings) {
                    AppState.settings = { ...AppState.settings, ...JSON.parse(savedSettings) };
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading application data', 'error');
            }
        }

        // Save data to localStorage
        function saveUsers() {
            localStorage.setItem('salaryAppUsers', JSON.stringify(AppState.users));
        }

        function saveHistory() {
            localStorage.setItem('salaryAppHistory', JSON.stringify(AppState.salaryHistory));
        }

        function saveSettings() {
            localStorage.setItem('salaryAppSettings', JSON.stringify(AppState.settings));
        }

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            AppState.isDarkMode = savedTheme === 'dark';
            
            if (AppState.isDarkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon')?.setAttribute('name', 'sun');
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon')?.setAttribute('name', 'moon');
            }
        }

        function toggleDarkMode() {
            AppState.isDarkMode = !AppState.isDarkMode;
            
            if (AppState.isDarkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').setAttribute('name', 'sun');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon').setAttribute('name', 'moon');
                localStorage.setItem('theme', 'light');
            }
        }

        // Screen management
        function switchScreen(screenName) {
            // Hide all screens
            const screens = ['login-screen', 'app-container'];
            screens.forEach(screen => {
                document.getElementById(screen)?.classList.add('hidden');
            });
            
            // Show requested screen
            document.getElementById(screenName)?.classList.remove('hidden');
            
            if (screenName === 'app-container') {
                initializeAppDashboard();
            }
        }

        // View management
        function switchView(viewName) {
            AppState.currentView = viewName;
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'salary-slip': 'Salary Slip',
                'history': 'History',
                'user-management': 'User Management',
                'analytics': 'Analytics',
                'settings': 'Settings',
                'bulk-export': 'Bulk Export'
            };
            document.getElementById('page-title').textContent = titles[viewName];
            
            // Hide all views
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show active view
            document.getElementById(`${viewName}-view`)?.classList.remove('hidden');
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.sidebar-btn[onclick*="${viewName}"]`)?.classList.add('active');
            
            // Close sidebar on mobile
            if (window.innerWidth < 1024) {
                toggleSidebar();
            }
            
            // Load view-specific data
            if (viewName === 'dashboard') {
                loadDashboardData();
            } else if (viewName === 'history') {
                loadHistory();
            } else if (viewName === 'user-management') {
                loadUsersTable();
            } else if (viewName === 'analytics') {
                loadAnalytics();
            } else if (viewName === 'settings') {
                loadSettings();
            }
        }

        // Sidebar management
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // Authentication
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('login-error');
            
            // Clear previous error
            errorDiv.classList.add('hidden');
            
            // Validation
            if (!username || !password) {
                errorDiv.textContent = 'Please enter both username and password';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Show loading
            document.getElementById('loading-screen').classList.remove('hidden');
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Find user
            const user = AppState.users.find(u => 
                u.email === username && u.password === password && u.status === 'active'
            );
            
            if (user) {
                // Update last login
                user.lastLogin = new Date().toISOString();
                saveUsers();
                
                AppState.currentUser = user;
                AppState.currentRole = user.role;
                
                // Show app
                switchScreen('app-container');
                showToast('Login successful!', 'success');
            } else {
                errorDiv.textContent = 'Invalid username or password';
                errorDiv.classList.remove('hidden');
                showToast('Login failed. Please check credentials.', 'error');
            }
            
            // Hide loading
            document.getElementById('loading-screen').classList.add('hidden');
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                AppState.currentUser = null;
                AppState.currentRole = 'employee';
                
                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // Show login screen
                switchScreen('login-screen');
                
                showToast('Logged out successfully', 'success');
            }
        }

        // Initialize app dashboard
        function initializeAppDashboard() {
            // Set current user info
            document.getElementById('current-user-email').textContent = AppState.currentUser.email;
            document.getElementById('user-name').textContent = AppState.currentUser.name;
            
            // Show/hide admin features
            if (AppState.currentRole === 'admin') {
                document.getElementById('admin-nav').classList.remove('hidden');
                document.getElementById('admin-views').classList.remove('hidden');
                document.getElementById('admin-badge').classList.remove('hidden');
            } else {
                document.getElementById('admin-nav').classList.add('hidden');
                document.getElementById('admin-views').classList.add('hidden');
                document.getElementById('admin-badge').classList.add('hidden');
            }
            
            // Load initial view
            switchView('dashboard');
        }

        // Dashboard functions
        function loadDashboardData() {
            // Calculate dashboard stats
            const userHistory = AppState.salaryHistory.filter(h => 
                AppState.currentRole === 'admin' || h.userId === AppState.currentUser.id
            );
            
            const totalEarnings = userHistory.reduce((sum, slip) => 
                sum + (parseInt(slip.netPay) || 0), 0
            );
            
            const thisMonth = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            const thisMonthSlip = userHistory.find(slip => slip.payPeriod === thisMonth);
            
            // Update dashboard
            document.getElementById('total-earnings-dash').textContent = totalEarnings.toLocaleString();
            document.getElementById('saved-slips-count').textContent = userHistory.length;
            document.getElementById('this-month-salary').textContent = 
                (thisMonthSlip?.netPay || 0).toLocaleString();
            document.getElementById('total-users-dash').textContent = AppState.users.length;
        }

        // Salary calculation
        function calculateSalary() {
            try {
                // Get input values
                const basic = parseFloat(document.getElementById('basic-input').value) || 0;
                const hra = parseFloat(document.getElementById('hra-input').value) || 0;
                const special = parseFloat(document.getElementById('special-input').value) || 0;
                const bonus = parseFloat(document.getElementById('bonus-input').value) || 0;
                const conveyance = 1600; // Fixed
                const medical = 1250; // Fixed
                const overtime = 2000; // Fixed
                
                // Deductions
                const professionalTax = 200;
                const tds = 1500;
                const loanRecovery = 1000;
                
                // Calculate PF (12% of basic)
                const pf = Math.round(basic * (AppState.settings.pfPercentage / 100));
                
                // Calculate total earnings
                const totalEarnings = basic + hra + conveyance + medical + special + overtime + bonus;
                
                // Calculate ESI (0.75% of gross if <= 21000)
                let esi = 0;
                if (totalEarnings <= AppState.settings.esiLimit) {
                    esi = Math.round(totalEarnings * (AppState.settings.esiPercentage / 100));
                }
                
                const totalDeductions = pf + esi + professionalTax + tds + loanRecovery;
                const netPay = Math.max(0, totalEarnings - totalDeductions);
                
                // Update display
                document.getElementById('basic-amount').textContent = basic.toLocaleString();
                document.getElementById('hra-amount').textContent = hra.toLocaleString();
                document.getElementById('conveyance-amount').textContent = conveyance.toLocaleString();
                document.getElementById('medical-amount').textContent = medical.toLocaleString();
                document.getElementById('special-amount').textContent = special.toLocaleString();
                document.getElementById('overtime-amount').textContent = overtime.toLocaleString();
                document.getElementById('bonus-amount').textContent = bonus.toLocaleString();
                document.getElementById('total-earnings').textContent = totalEarnings.toLocaleString();
                
                document.getElementById('pf-amount').textContent = pf.toLocaleString();
                document.getElementById('esi-amount').textContent = esi.toLocaleString();
                document.getElementById('pt-amount').textContent = professionalTax.toLocaleString();
                document.getElementById('tds-amount').textContent = tds.toLocaleString();
                document.getElementById('loan-amount').textContent = loanRecovery.toLocaleString();
                document.getElementById('total-deductions').textContent = totalDeductions.toLocaleString();
                
                document.getElementById('net-pay').textContent = `₹${netPay.toLocaleString()}`;
                document.getElementById('net-pay-words').textContent = numberToWords(netPay);
                
                showToast('Salary calculated successfully!', 'success');
                
            } catch (error) {
                console.error('Error calculating salary:', error);
                showToast('Error calculating salary', 'error');
            }
        }

        // Reverse salary calculation
        function calculateReverseSalary() {
            try {
                const desiredSalary = parseFloat(document.getElementById('desired-salary-input').value) || 0;
                const basicPercentage = parseFloat(document.getElementById('basic-percentage-input').value) || 50;
                
                if (desiredSalary <= 0) {
                    showToast('Please enter a valid desired salary', 'warning');
                    return;
                }
                
                // Calculate required CTC to achieve desired in-hand salary
                // This is a simplified calculation - in real scenario, you'd need more complex logic
                const pfRate = AppState.settings.pfPercentage / 100;
                const esiRate = AppState.settings.esiPercentage / 100;
                
                // Estimate CTC required (simplified formula)
                let ctc = desiredSalary * 1.4; // Start with estimation
                
                // Iterate to find accurate CTC
                for (let i = 0; i < 10; i++) {
                    const basic = ctc * (basicPercentage / 100);
                    const pf = basic * pfRate;
                    const gross = ctc - pf;
                    const esi = gross <= AppState.settings.esiLimit ? gross * esiRate : 0;
                    const tax = gross * 0.1; // Simplified tax calculation
                    const net = ctc - pf - esi - tax - 200 - 1500 - 1000; // Other deductions
                    
                    if (Math.abs(net - desiredSalary) < 100) break;
                    
                    // Adjust CTC
                    ctc += (desiredSalary - net) * 0.7;
                }
                
                const basic = ctc * (basicPercentage / 100);
                const hra = basic * (AppState.settings.hraPercentage / 100);
                const allowances = ctc - basic - hra;
                
                // Update display
                document.getElementById('required-ctc').textContent = Math.round(ctc).toLocaleString();
                document.getElementById('ctc-basic').textContent = Math.round(basic).toLocaleString();
                document.getElementById('ctc-hra').textContent = Math.round(hra).toLocaleString();
                document.getElementById('ctc-allowances').textContent = Math.round(allowances).toLocaleString();
                
                document.getElementById('reverse-result').classList.remove('hidden');
                showToast('CTC calculation completed!', 'success');
                
            } catch (error) {
                console.error('Error in reverse calculation:', error);
                showToast('Error calculating CTC', 'error');
            }
        }

        // Save salary to history
        function saveSalaryToHistory() {
            try {
                const slipData = {
                    id: Date.now().toString(),
                    userId: AppState.currentUser.id,
                    userEmail: AppState.currentUser.email,
                    employeeName: document.getElementById('employee-name-input').value || 'John Doe',
                    designation: document.getElementById('designation-input').value || 'Software Engineer',
                    department: document.getElementById('department-input').value || 'Engineering',
                    bankAccount: document.getElementById('bank-account-input').value || 'XXXXXX1234',
                    panNumber: document.getElementById('pan-number-input').value || 'ABCDE1234F',
                    payPeriod: document.getElementById('pay-period').textContent,
                    paidDays: parseInt(document.getElementById('paid-days-input').value) || 31,
                    lossOfPayDays: parseInt(document.getElementById('lop-days-input').value) || 0,
                    
                    basic: parseInt(document.getElementById('basic-amount').textContent.replace(/,/g, '')) || 0,
                    hra: parseInt(document.getElementById('hra-amount').textContent.replace(/,/g, '')) || 0,
                    conveyanceAllowance: parseInt(document.getElementById('conveyance-amount').textContent.replace(/,/g, '')) || 0,
                    medicalAllowance: parseInt(document.getElementById('medical-amount').textContent.replace(/,/g, '')) || 0,
                    specialAllowance: parseInt(document.getElementById('special-amount').textContent.replace(/,/g, '')) || 0,
                    overtime: parseInt(document.getElementById('overtime-amount').textContent.replace(/,/g, '')) || 0,
                    bonus: parseInt(document.getElementById('bonus-amount').textContent.replace(/,/g, '')) || 0,
                    
                    pf: parseInt(document.getElementById('pf-amount').textContent.replace(/,/g, '')) || 0,
                    esi: parseInt(document.getElementById('esi-amount').textContent.replace(/,/g, '')) || 0,
                    professionalTax: parseInt(document.getElementById('pt-amount').textContent.replace(/,/g, '')) || 0,
                    tds: parseInt(document.getElementById('tds-amount').textContent.replace(/,/g, '')) || 0,
                    loanRecovery: parseInt(document.getElementById('loan-amount').textContent.replace(/,/g, '')) || 0,
                    
                    totalEarnings: parseInt(document.getElementById('total-earnings').textContent.replace(/,/g, '')) || 0,
                    totalDeductions: parseInt(document.getElementById('total-deductions').textContent.replace(/,/g, '')) || 0,
                    netPay: parseInt(document.getElementById('net-pay').textContent.replace(/[₹,]/g, '')) || 0,
                    
                    createdAt: new Date().toISOString()
                };
                
                AppState.salaryHistory.push(slipData);
                saveHistory();
                
                showToast('Salary slip saved to history!', 'success');
                loadHistory();
                
            } catch (error) {
                console.error('Error saving salary slip:', error);
                showToast('Error saving salary slip', 'error');
            }
        }

        // Load salary history
        function loadHistory() {
            const historyList = document.getElementById('salary-history-list');
            
            // Filter history based on user role
            let userHistory;
            if (AppState.currentRole === 'admin') {
                userHistory = AppState.salaryHistory;
            } else {
                userHistory = AppState.salaryHistory.filter(h => h.userId === AppState.currentUser.id);
            }
            
            // Sort by date (newest first)
            userHistory.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (userHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-12">
                        <i data-lucide="file-text" class="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto"></i>
                        <p class="mt-4 text-gray-500 dark:text-gray-400">No salary history yet</p>
                        <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">Save your first salary slip!</p>
                    </div>
                `;
            } else {
                historyList.innerHTML = '';
                
                // Update stats
                const totalEarnings = userHistory.reduce((sum, slip) => sum + slip.netPay, 0);
                const averageSalary = userHistory.length > 0 ? totalEarnings / userHistory.length : 0;
                
                document.getElementById('total-saved-slips').textContent = userHistory.length;
                document.getElementById('total-history-earnings').textContent = `₹${totalEarnings.toLocaleString()}`;
                document.getElementById('average-salary').textContent = `₹${averageSalary.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
                
                userHistory.forEach(slip => {
                    const slipElement = createHistoryItem(slip);
                    historyList.appendChild(slipElement);
                });
            }
            
            // Reinitialize icons
            lucide.createIcons();
        }

        // Create history item element
        function createHistoryItem(slip) {
            const div = document.createElement('div');
            div.className = 'p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:shadow-md transition cursor-pointer group';
            div.onclick = () => loadSlipIntoCalculator(slip.id);
            
            div.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h3 class="font-semibold text-gray-800 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400">${slip.payPeriod}</h3>
                            <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300 px-2 py-1 rounded">Saved</span>
                            ${AppState.currentRole === 'admin' ? 
                                `<span class="text-xs bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-300 px-2 py-1 rounded">${slip.userEmail}</span>` : ''}
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                            ${new Date(slip.createdAt).toLocaleDateString('en-IN', { 
                                day: 'numeric', 
                                month: 'short', 
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </p>
                        <div class="flex items-center gap-4 mt-2 text-sm">
                            <span class="text-gray-600 dark:text-gray-400">${slip.employeeName}</span>
                            <span class="text-gray-600 dark:text-gray-400">Basic: ₹${slip.basic.toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="text-right ml-4">
                        <div class="text-xl font-bold text-green-600">₹${slip.netPay.toLocaleString()}</div>
                        <div class="flex gap-2 mt-2">
                            <button onclick="event.stopPropagation(); loadSlipIntoCalculator('${slip.id}')" 
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
                                    title="Load into Calculator">
                                <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
                            </button>
                            <button onclick="event.stopPropagation(); deleteSlipFromHistory('${slip.id}')" 
                                    class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300"
                                    title="Delete">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                            <button onclick="event.stopPropagation(); downloadSlipAsPDF('${slip.id}')" 
                                    class="text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300"
                                    title="Download PDF">
                                <i data-lucide="download" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return div;
        }

        // Load slip into calculator
        function loadSlipIntoCalculator(slipId) {
            const slip = AppState.salaryHistory.find(s => s.id === slipId);
            if (!slip) return;
            
            // Fill form with slip data
            document.getElementById('employee-name-input').value = slip.employeeName;
            document.getElementById('designation-input').value = slip.designation;
            document.getElementById('department-input').value = slip.department;
            document.getElementById('bank-account-input').value = slip.bankAccount;
            document.getElementById('pan-number-input').value = slip.panNumber;
            document.getElementById('pay-period').textContent = slip.payPeriod;
            document.getElementById('paid-days-input').value = slip.paidDays;
            document.getElementById('lop-days-input').value = slip.lossOfPayDays;
            
            document.getElementById('basic-input').value = slip.basic;
            document.getElementById('hra-input').value = slip.hra;
            document.getElementById('special-input').value = slip.specialAllowance;
            document.getElementById('bonus-input').value = slip.bonus;
            
            // Calculate and update display
            calculateSalary();
            
            // Switch to salary slip view
            switchView('salary-slip');
            
            showToast(`Loaded ${slip.payPeriod} slip`, 'success');
        }

        // Delete slip from history
        function deleteSlipFromHistory(slipId) {
            if (confirm('Are you sure you want to delete this salary slip?')) {
                AppState.salaryHistory = AppState.salaryHistory.filter(s => s.id !== slipId);
                saveHistory();
                loadHistory();
                showToast('Salary slip deleted', 'success');
            }
        }

        // Clear all history
        function clearHistory() {
            if (confirm('Are you sure you want to clear all salary history? This action cannot be undone.')) {
                if (AppState.currentRole === 'admin') {
                    AppState.salaryHistory = [];
                } else {
                    AppState.salaryHistory = AppState.salaryHistory.filter(h => h.userId !== AppState.currentUser.id);
                }
                saveHistory();
                loadHistory();
                showToast('History cleared', 'success');
            }
        }

        // Search history
        function searchHistory(query) {
            const items = document.querySelectorAll('#salary-history-list > div');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query.toLowerCase()) ? 'block' : 'none';
            });
        }

        // User management
        function loadUsersTable() {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            
            AppState.users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="user" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div>
                                <div class="font-medium text-gray-900 dark:text-white">${user.name}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300' : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'}">
                            ${user.role}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.status === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300'}">
                            ${user.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                        ${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editUser('${user.id}')" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3">Edit</button>
                        ${user.id !== AppState.currentUser.id ? 
                            `<button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Delete</button>` : 
                            ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Reinitialize icons
            lucide.createIcons();
        }

        function searchUsers(query) {
            const rows = document.querySelectorAll('#users-table-body tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query.toLowerCase()) ? 'table-row' : 'none';
            });
        }

        function filterUsersByRole(role) {
            const rows = document.querySelectorAll('#users-table-body tr');
            rows.forEach(row => {
                if (role === 'all') {
                    row.style.display = 'table-row';
                } else {
                    const roleText = row.cells[1].textContent.toLowerCase();
                    row.style.display = roleText.includes(role) ? 'table-row' : 'none';
                }
            });
        }

        function filterUsersByStatus(status) {
            const rows = document.querySelectorAll('#users-table-body tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = 'table-row';
                } else {
                    const statusText = row.cells[2].textContent.toLowerCase();
                    row.style.display = statusText.includes(status) ? 'table-row' : 'none';
                }
            });
        }

        // Add user modal
        function showAddUserModal() {
            document.getElementById('add-user-modal').classList.remove('hidden');
        }

        function closeAddUserModal() {
            document.getElementById('add-user-modal').classList.add('hidden');
            document.getElementById('new-user-email').value = '';
            document.getElementById('new-user-password').value = '';
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-role').value = 'employee';
            document.getElementById('add-user-error').classList.add('hidden');
        }

        function addNewUser() {
            const email = document.getElementById('new-user-email').value;
            const password = document.getElementById('new-user-password').value;
            const name = document.getElementById('new-user-name').value;
            const role = document.getElementById('new-user-role').value;
            const errorDiv = document.getElementById('add-user-error');
            
            // Clear error
            errorDiv.classList.add('hidden');
            
            // Validation
            if (!email || !password || !name) {
                errorDiv.textContent = 'Please fill all required fields';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (!email.includes('@')) {
                errorDiv.textContent = 'Please enter a valid email address';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (password.length < 6) {
                errorDiv.textContent = 'Password must be at least 6 characters';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Check if user already exists
            if (AppState.users.some(u => u.email === email)) {
                errorDiv.textContent = 'User with this email already exists';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Add user
            const newUser = {
                id: Date.now().toString(),
                email,
                password,
                name,
                role,
                status: 'active',
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            AppState.users.push(newUser);
            saveUsers();
            
            closeAddUserModal();
            loadUsersTable();
            showToast(`User ${email} added successfully`, 'success');
        }

        // Edit user
        function editUser(userId) {
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            AppState.editingUserId = userId;
            
            document.getElementById('edit-user-email').value = user.email;
            document.getElementById('edit-user-name').value = user.name;
            document.getElementById('edit-user-role').value = user.role;
            document.getElementById('edit-user-status').value = user.status;
            document.getElementById('edit-user-error').classList.add('hidden');
            
            document.getElementById('edit-user-modal').classList.remove('hidden');
        }

        function closeEditUserModal() {
            document.getElementById('edit-user-modal').classList.add('hidden');
            AppState.editingUserId = null;
        }

        function saveEditedUser() {
            const userId = AppState.editingUserId;
            const user = AppState.users.find(u => u.id === userId);
            if (!user) return;
            
            const name = document.getElementById('edit-user-name').value;
            const role = document.getElementById('edit-user-role').value;
            const status = document.getElementById('edit-user-status').value;
            const errorDiv = document.getElementById('edit-user-error');
            
            // Clear error
            errorDiv.classList.add('hidden');
            
            // Validation
            if (!name) {
                errorDiv.textContent = 'Name is required';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            // Update user
            user.name = name;
            user.role = role;
            user.status = status;
            
            saveUsers();
            closeEditUserModal();
            loadUsersTable();
            showToast('User updated successfully', 'success');
        }

        function deleteUser(userId) {
            if (userId === AppState.currentUser.id) {
                showToast('You cannot delete your own account', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this user?')) {
                AppState.users = AppState.users.filter(u => u.id !== userId);
                saveUsers();
                loadUsersTable();
                showToast('User deleted successfully', 'success');
            }
        }

        // Analytics
        function loadAnalytics() {
            // Initialize charts if they don't exist
            if (!AppState.charts.salaryChart) {
                const salaryCtx = document.getElementById('salaryChart').getContext('2d');
                AppState.charts.salaryChart = new Chart(salaryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Basic', 'HRA', 'Allowances', 'Bonus', 'Deductions'],
                        datasets: [{
                            data: [30000, 12000, 20000, 5000, 6300],
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b',
                                '#ef4444'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }
            
            if (!AppState.charts.activityChart) {
                const activityCtx = document.getElementById('activityChart').getContext('2d');
                AppState.charts.activityChart = new Chart(activityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Salary Slips Generated',
                            data: [12, 19, 15, 25, 22, 30],
                            backgroundColor: '#3b82f6',
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Update analytics data
            const activeUsers = AppState.users.filter(u => u.status === 'active').length;
            const totalPayroll = AppState.salaryHistory.reduce((sum, slip) => sum + slip.netPay, 0);
            const avgSalary = AppState.salaryHistory.length > 0 ? 
                totalPayroll / AppState.salaryHistory.length : 0;
            
            document.getElementById('total-payroll').textContent = `₹${totalPayroll.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
            document.getElementById('avg-salary').textContent = `₹${avgSalary.toLocaleString(undefined, {maximumFractionDigits: 0})}`;
            document.getElementById('active-users').textContent = activeUsers;
            document.getElementById('slips-generated').textContent = AppState.salaryHistory.length;
        }

        // Settings
        function loadSettings() {
            document.getElementById('pf-percentage').value = AppState.settings.pfPercentage;
            document.getElementById('esi-percentage').value = AppState.settings.esiPercentage;
            document.getElementById('hra-percentage').value = AppState.settings.hraPercentage;
            document.getElementById('esi-limit').value = AppState.settings.esiLimit;
            document.getElementById('company-name').value = AppState.settings.companyName;
            document.getElementById('company-address').value = AppState.settings.companyAddress;
        }

        function saveSalarySettings() {
            AppState.settings.pfPercentage = parseFloat(document.getElementById('pf-percentage').value) || 12;
            AppState.settings.esiPercentage = parseFloat(document.getElementById('esi-percentage').value) || 0.75;
            AppState.settings.hraPercentage = parseFloat(document.getElementById('hra-percentage').value) || 40;
            AppState.settings.esiLimit = parseFloat(document.getElementById('esi-limit').value) || 21000;
            AppState.settings.companyName = document.getElementById('company-name').value;
            AppState.settings.companyAddress = document.getElementById('company-address').value;
            
            saveSettings();
            showToast('Settings saved successfully', 'success');
        }

        // Export functions
        function exportSalaryData() {
            try {
                const data = AppState.salaryHistory.map(slip => ({
                    'Pay Period': slip.payPeriod,
                    'Employee Name': slip.employeeName,
                    'Designation': slip.designation,
                    'Department': slip.department,
                    'Basic': slip.basic,
                    'HRA': slip.hra,
                    'Special Allowance': slip.specialAllowance,
                    'Bonus': slip.bonus,
                    'PF': slip.pf,
                    'ESI': slip.esi,
                    'Total Earnings': slip.totalEarnings,
                    'Total Deductions': slip.totalDeductions,
                    'Net Pay': slip.netPay,
                    'Generated Date': new Date(slip.createdAt).toLocaleDateString()
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Salary Data');
                
                const fileName = `salary_data_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showToast('Salary data exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting salary data:', error);
                showToast('Error exporting data', 'error');
            }
        }

        function exportUserData() {
            try {
                const data = AppState.users.map(user => ({
                    'Name': user.name,
                    'Email': user.email,
                    'Role': user.role,
                    'Status': user.status,
                    'Last Login': user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never',
                    'Created Date': new Date(user.createdAt).toLocaleDateString()
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'User Data');
                
                const fileName = `user_data_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showToast('User data exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting user data:', error);
                showToast('Error exporting data', 'error');
            }
        }

        // PDF Generation
        function downloadAsPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add company logo and header
                doc.setFontSize(20);
                doc.text('SALARY SLIP', 105, 20, { align: 'center' });
                
                doc.setFontSize(10);
                doc.text(AppState.settings.companyName || 'Your Company Name', 105, 30, { align: 'center' });
                doc.text(AppState.settings.companyAddress || 'Company Address', 105, 35, { align: 'center' });
                
                // Add employee details
                doc.setFontSize(12);
                doc.text('Employee Details:', 20, 50);
                
                doc.setFontSize(10);
                doc.text(`Name: ${document.getElementById('employee-name-input').value || 'John Doe'}`, 20, 60);
                doc.text(`Designation: ${document.getElementById('designation-input').value || 'Software Engineer'}`, 20, 65);
                doc.text(`Department: ${document.getElementById('department-input').value || 'Engineering'}`, 20, 70);
                doc.text(`Pay Period: ${document.getElementById('pay-period').textContent}`, 20, 75);
                
                // Add salary table
                doc.autoTable({
                    startY: 85,
                    head: [['Particulars', 'Earnings (₹)', 'Particulars', 'Deductions (₹)']],
                    body: [
                        ['Basic', document.getElementById('basic-amount').textContent, 'PF', document.getElementById('pf-amount').textContent],
                        ['HRA', document.getElementById('hra-amount').textContent, 'ESI', document.getElementById('esi-amount').textContent],
                        ['Conveyance', document.getElementById('conveyance-amount').textContent, 'Professional Tax', document.getElementById('pt-amount').textContent],
                        ['Medical', document.getElementById('medical-amount').textContent, 'TDS', document.getElementById('tds-amount').textContent],
                        ['Special Allowance', document.getElementById('special-amount').textContent, 'Loan Recovery', document.getElementById('loan-amount').textContent],
                        ['Overtime', document.getElementById('overtime-amount').textContent, '', ''],
                        ['Bonus', document.getElementById('bonus-amount').textContent, '', ''],
                        ['Total Earnings', document.getElementById('total-earnings').textContent, 'Total Deductions', document.getElementById('total-deductions').textContent]
                    ],
                    theme: 'grid'
                });
                
                // Add net pay
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(14);
                doc.text('NET PAYABLE:', 20, finalY);
                doc.text(document.getElementById('net-pay').textContent, 180, finalY, { align: 'right' });
                
                doc.setFontSize(10);
                doc.text(`In Words: ${document.getElementById('net-pay-words').textContent}`, 20, finalY + 10);
                
                // Add footer
                doc.setFontSize(8);
                doc.text('Generated by Salary Management System', 105, 280, { align: 'center' });
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 285, { align: 'center' });
                
                // Save PDF
                const fileName = `salary_slip_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showToast('PDF downloaded successfully', 'success');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showToast('Error generating PDF', 'error');
            }
        }

        function downloadSlipAsPDF(slipId) {
            const slip = AppState.salaryHistory.find(s => s.id === slipId);
            if (!slip) return;
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add slip details to PDF
                doc.setFontSize(20);
                doc.text('SALARY SLIP', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text(`Pay Period: ${slip.payPeriod}`, 20, 40);
                doc.text(`Employee: ${slip.employeeName}`, 20, 50);
                
                // Add salary table
                doc.autoTable({
                    startY: 65,
                    head: [['Earnings', 'Amount (₹)', 'Deductions', 'Amount (₹)']],
                    body: [
                        ['Basic', slip.basic.toLocaleString(), 'PF', slip.pf.toLocaleString()],
                        ['HRA', slip.hra.toLocaleString(), 'ESI', slip.esi.toLocaleString()],
                        ['Conveyance', slip.conveyanceAllowance.toLocaleString(), 'Prof. Tax', slip.professionalTax.toLocaleString()],
                        ['Medical', slip.medicalAllowance.toLocaleString(), 'TDS', slip.tds.toLocaleString()],
                        ['Special', slip.specialAllowance.toLocaleString(), 'Loan', slip.loanRecovery.toLocaleString()],
                        ['Total Earnings', slip.totalEarnings.toLocaleString(), 'Total Deductions', slip.totalDeductions.toLocaleString()]
                    ],
                    theme: 'grid'
                });
                
                // Add net pay
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(14);
                doc.text('NET PAYABLE:', 20, finalY);
                doc.text(`₹${slip.netPay.toLocaleString()}`, 180, finalY, { align: 'right' });
                
                // Save PDF
                const fileName = `salary_slip_${slip.payPeriod.replace(' ', '_')}.pdf`;
                doc.save(fileName);
                
                showToast('PDF downloaded successfully', 'success');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showToast('Error generating PDF', 'error');
            }
        }

        // Share via WhatsApp
        function shareOnWhatsApp() {
            const netPay = document.getElementById('net-pay').textContent;
            const payPeriod = document.getElementById('pay-period').textContent;
            const message = `Hello, Please find attached my Salary Slip for ${payPeriod}. Net Payable: ${netPay}.`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showToast('Opening WhatsApp...', 'info');
        }

        // Print salary slip
        function printSalarySlip() {
            window.print();
        }

        // Generate current month slip
        function generateCurrentMonthSlip() {
            const currentMonth = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('pay-period').textContent = currentMonth;
            
            // Auto-fill current date
            const today = new Date();
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const paidDays = daysInMonth - (parseInt(document.getElementById('lop-days-input').value) || 0);
            
            document.getElementById('paid-days-input').value = paidDays;
            
            // Calculate salary
            calculateSalary();
            showToast('Current month slip generated', 'success');
        }

        // Number to words function
        function numberToWords(num) {
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            
            if (num === 0) return 'Zero';
            
            function convertLessThanThousand(n) {
                if (n === 0) return '';
                
                let words = '';
                
                if (n >= 100) {
                    words += ones[Math.floor(n / 100)] + ' Hundred ';
                    n %= 100;
                }
                
                if (n >= 20) {
                    words += tens[Math.floor(n / 10)] + ' ';
                    n %= 10;
                }
                
                if (n >= 10 && n < 20) {
                    words += teens[n - 10] + ' ';
                    return words;
                }
                
                if (n > 0) {
                    words += ones[n] + ' ';
                }
                
                return words;
            }
            
            let result = '';
            let crore = Math.floor(num / 10000000);
            let lakh = Math.floor((num % 10000000) / 100000);
            let thousand = Math.floor((num % 100000) / 1000);
            let remainder = num % 1000;
            
            if (crore > 0) {
                result += convertLessThanThousand(crore) + 'Crore ';
            }
            
            if (lakh > 0) {
                result += convertLessThanThousand(lakh) + 'Lakh ';
            }
            
            if (thousand > 0) {
                result += convertLessThanThousand(thousand) + 'Thousand ';
            }
            
            result += convertLessThanThousand(remainder);
            
            return result.trim() + ' Rupees Only';
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'alert-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
                    <span>${message}</span>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
            
            // Reinitialize icons
            lucide.createIcons();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Enter key for login
            document.getElementById('password')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Close sidebar when clicking overlay
            document.getElementById('sidebar-overlay')?.addEventListener('click', toggleSidebar);
            
            // Close modals with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAddUserModal();
                    closeEditUserModal();
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
